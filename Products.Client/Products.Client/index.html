<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
</head>
<body>
    <a id="categories-link">Categories</a>
    <a id="products-link">Products</a>
    <div id="error-message"></div>
    <div id="content">

        <label for="name">Name</label>
        <input id="name" type="text" />
        <label for="categories">Category</label>
        <select id="categories">
            <option id="0"></option>
        </select>
        <ul id="products-list"></ul>
        <input id="prev-page" type="button" value="Previous" disabled="disabled" />

        <input id="next-page" type="button" value="Next" />
    </div>

    <script src="scripts/lib/jquery-1.11.2.min.js"></script>
    <script src="scripts/http-module.js"></script>

    <!--<input type="button" id="del" value="Delete"/>
    <input type="button" id="update" value="Update" />
    <input type="button" id="get-by-id" value="Get by id" />
    <input type="button" id="create" value="Create" />-->
    <!--<div id="result"></div>-->

    <script>
        var baseUrl = 'http://localhost:53043/api/';
        var productsBaseUrl = baseUrl + '/products/';
        var categoriesBaseUrl = baseUrl + '/categories/';
        var currentPage = 0;
        httpModule.get(categoriesBaseUrl, onLoadCategories, onError);
        httpModule.get(productsBaseUrl + '?page=0', onLoadProducts, onError);
        //$('#del').click(function () {
        //    httpModule.del(productsBaseUrl+20, {}, onSuccess, onError);
        //});
        //$('#update').click(function () {
        //    httpModule.put(productsBaseUrl, { categoryId: 20, name: 'Client category edited', description: 'edited client description' }, onSuccess, onError);
        //});
        //$('#create').click(function () {
        //    httpModule.post(productsBaseUrl, {name: 'Client category', description: 'client description'}, onSuccess, onError);
        //});

        //function onSuccess(data) {
        //        $('#result').text(data);
        //}

        $('#prev-page').click(function () {
            var $this = $(this);
            currentPage -= 1;
            httpModule.get(productsBaseUrl + currentPage, onLoadProducts, onError);
            if (currentPage == 0) {
                $this.attr('disabled', 'disabled');
            }
        });
        $('#next-page').click(function () {
            currentPage += 1;
            httpModule.get(productsBaseUrl + currentPage, onLoadProducts, onError);
            $('#prev-page').removeAttr('disabled');
            //TODO: last page
        });

        function onLoadProducts(products) {
            var $productsList = $('#products-list');
            $productsList.children().remove();

            var $listItem = $('<li/>')
                .append($('<img width=50 height=25/>'))
                .append('<br>')
                .append('<a href="#" class="name">')
                .append('<br>')
                .append('<a href="#" class="edit">Edit </a>')
                .append('<a href="#" class="delete">Delete </a>')
                .append('<br>');

            for (var i = 0; i < products.length; i++) {
                var product = products[i];
                var $currentListItem = $listItem.clone();
                $currentListItem.attr('id', product.ProductId);
                //TODO: load picture
                $currentListItem.find('img').attr('src', "http://bestpics.in/wp-content/uploads/2014/08/ice-ice-babies-pictures-2.jpg");
                $currentListItem.find('.name').html(product.Name);
                $productsList.append($currentListItem);
            }
            //TODO: onclick for Edit and Delete
            //$("ul").on("click", "li", onListItemClick);
        }

        function onLoadCategories(categories) {
            var $categories = $('#categories');
            if ($categories.children().length > 1) {
                return;
            }            

            var $optionItem = $('<option/>');
            for (var i = 0; i < categories.length; i++) {
                var category = categories[i];
                var $currentOptionItem = $optionItem.clone();
                $currentOptionItem.attr('id', category.CategoryId);
                $currentOptionItem.html(category.Name);
                $categories.append($currentOptionItem);
            }
        }

        function onError(err) {
            $('#error-message').text(err.message);
        }
    </script>
</body>

</html>
